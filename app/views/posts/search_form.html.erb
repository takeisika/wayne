
<p class="user_new_letter">キーワード検索</p3>


<div class="search_form">
<%= form_with url: "/posts/search_form", method: :get, local: true do |form| %>
  <%= form.text_field :hashsearch ,placeholder: "\uf002検索" ,value:params[:hashsearch] ,class:"fa fa-xs search_form_text" %>
<% end %>
</div>





<div class="container search_form_container">
<%if @hashtags.present?%>

<div class="hashtag_header search_form_count">
<p>投稿<span><%=@hashtags.count%></span>件</p>
</div>



<%@hashtags.each do |hashtag|%>
<%@posts=Post.where(id: hashtag.post_id)%>





<% @posts.each do |post| %>
   <%@user=User.find_by(id:post.user_id)%>
   <%if @user%>
   <div class="index_<%=post.id%>">
    <%= link_to("/posts/#{post.id}/comment",class: "link")do %>
     <div class="index">
     <div class="index_right_left">
      <div class="index_left">
       <div class="index_gazo">
        <%if @user.avator.attached?%>
        <object><%= link_to image_tag(@user.avator),@user.avator, :rel => "lightbox" %></object>
        <%else%>
        <object><a href="/default.jpg" data-lightbox="group"><%=image_tag "/default.jpg"%></a></object>
        <%end%>
       </div>
        <div class="index_likes_comments">
         <object><div id="likes_buttons_<%= post.id %>">
          <%= render partial: 'like', locals: { post: post} %>
         </div></object>
         <div class="index_comments">
          
           <span class="fas fa-comment fa-xs"><%=Comment.where(comment_id: post.id).count%></span>
          
         </div>
        </div>
      </div>
 
      
      <div class="index_right">
       <div class="index_header">
       <object class="index_user_name"><%=link_to(@user.name,"/users/#{@user.id}")%></object>
        <p><%= post.updated_at.to_s(:datetime_jp) %></p>
       </div>
      
    
    

       <div class="index_title">
        <%=post.title%>
       </div>
       <div class="index_setu">


       <p><%=post.content%></p>


         
            
       <% if post.tag%>
       <%@hashtags=post.tag.scan(/[#＃][\w\p{Han}ぁ-ヶｦ-ﾟー]+/)%>
         <%@hashtags.uniq.map do |hashtag|%>
            <%@tag = Hashtag.find_or_create_by(hashname: hashtag, post_id: post.id)%>
            <%@tag.save%>
            <%@hash=Hashtag.find_by(hashname: hashtag)%>
            <object class="tag"><%=link_to(highlight(@hash.hashname, params[:hashsearch]),"/hashtags/#{@hash.id}")%></object>
         <%end%>
         <%end%>

       </div>
       
       


       <div class="index_right_file">
       

       <%if post.files.attached?%>
       <%if post.files.count==1 %>
       <% post.files.each do |file| %>
          <object class="one"><%= link_to image_tag(file),file, :rel => "lightbox" %></object>
       <%end%>
       <%end%>
       <%if post.files.count==2 %>
       <% post.files.each do |file| %>
          <object class="two"><%= link_to image_tag(file),file, :rel => "lightbox" %></object>
       <%end%>
       <%end%>
       <%if post.files.count==3 %>
       <% post.files.each do |file| %>
          <object class="three"><%= link_to image_tag(file),file, :rel => "lightbox" %></object>
       <%end%>
       <%end%>
       <%if post.files.count==4 %>
       <% post.files.each do |file| %>
          <object class="four"><%= link_to image_tag(file),file, :rel => "lightbox" %></object>
       <%end%>
       <%end%>
       <%end%>


       <%if post.movies.attached?%>
       <%if post.movies.count==1 %>
       <% post.movies.each do |movie| %>
          <object class="one"><video src="<%= rails_blob_path(movie) %>" type="video/mp4" controls></video></object>
       <%end%>
       <%end%>
       <%if post.movies.count==2 %>
       <% post.movies.each do |movie| %>
          <object class="two"><video src="<%= rails_blob_path(movie) %>" type="video/mp4" controls></video></object>
       <%end%>
       <%end%>
       <%if post.movies.count==3 %>
       <% post.movies.each do |movie| %>
          <object class="three"><video src="<%= rails_blob_path(movie) %>" type="video/mp4" controls></video></object>
       <%end%>
       <%end%>
       <%if post.movies.count==4 %>
       <% post.movies.each do |movie| %>
          <object class="four"><video src="<%= rails_blob_path(movie) %>" type="video/mp4" controls></video></object>
       <%end%>
       <%end%>
       <%end%>


       <%if post.tube?%>
       <%@post_tube=post.tube%>
       <%@post_tube=@post_tube.last(11)%>
       <object><iframe src="https://www.youtube.com/embed/<%=@post_tube%>" type="video/mp4" controls></iframe></object>
       <object class="index_right_file_url"><p><%=link_to("https://youtu.be/#{@post_tube}","https://youtu.be/#{@post_tube}")%></p></object>
       <%end%>







       </div>
       </div>
       </div>
      

      
      <div class="comment_edit">
      <%if @current_user%>
      <%if @current_user.id==post.user_id%>
        <object><%=link_to("編集","/posts/#{post.id}/edit")%></object>
        <object><%=link_to("削除","/posts/#{post.id}/destroy",method: :post,remote: true)%></object>
       <%end%>
       <%end%>
     </div>
     

      

  </div>
  <%end%>
  </div>
  <%end%>
<%end%>

    <%end%>
    <%else%>
    　<%if flash[:alert]%>
     　<p class="search_form_nil">
      　<%=flash[:alert]%>
     　</p>
    　<%end%>
    <%end%>
    </div>